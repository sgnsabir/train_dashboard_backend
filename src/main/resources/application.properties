# =========================================
# Application Name and Profile
# =========================================
spring.application.name=predictive-maintenance-backend
spring.profiles.active=production
spring.main.web-application-type=reactive

# =========================================
# Server Configuration
# =========================================
server.port=8080
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# Allow bean definition overriding (useful for resolving conflicting beans)
spring.main.allow-bean-definition-overriding=true

# Exclude non-reactive Redis auto-configuration to avoid duplicate RedisConnectionFactory beans
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration

# =========================================
# R2DBC Database Connection (Reactive)
# =========================================
spring.r2dbc.url=r2dbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:banenor_db}
spring.r2dbc.username=${DB_USERNAME:postgres}
spring.r2dbc.password=${DB_PASSWORD:0000}

# R2DBC Connection Pooling
spring.r2dbc.pool.initial-size=5
spring.r2dbc.pool.max-size=20

# R2DBC Initialization (similar in spirit to ddl-auto update)
spring.sql.init.mode=always
spring.r2dbc.initialization-mode=update
spring.r2dbc.schema=classpath:schema.sql
spring.r2dbc.data=classpath:data.sql

# Set R2DBC logging to WARN so you don't constantly see SQL statements in logs
logging.level.org.springframework.r2dbc.core=WARN
logging.level.io.r2dbc.postgresql=INFO

# =========================================
# JWT Configuration
# =========================================
jwt.secret=${JWT_SECRET:ahZLfXRYnJ+rl6zrd07Csxyc7EslWqNOZa+Zl/HK3M5mOXDLuoPAczd/Y+VZgTlcfpPSjEnZwVbje9NLhIUFzg==}
jwt.expirationSeconds=3600000

# =========================================
# Kafka Configuration (High-Performance Messaging)
# =========================================
# Updated default to use internal broker address for Docker: "kafka:9092" instead of "localhost:29092"
kafka.bootstrap-servers=${SPRING_KAFKA_BOOTSTRAP_SERVERS:kafka:9092}
kafka.topic.sensor-data=sensor-data-topic
kafka.topic.dead-letter=sensor-data-dead-letter-topic
kafka.sensor.topic=sensor-data-topic
kafka.consumer.max-poll-records=50
kafka.consumer.auto-offset-reset=earliest
kafka.consumer.enable-auto-commit=false
# Added property so that ${kafka.consumer.group-id} is resolved:
kafka.consumer.group-id=banenor-sensor-data-group

# Also for Spring Boot Kafka (backward compatibility)
spring.kafka.consumer.group-id=banenor-sensor-data-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer

# =========================================
# Redis & Caching Configuration
# =========================================
spring.cache.type=redis
spring.data.redis.host=${SPRING_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_REDIS_PORT:6379}
spring.cache.redis.cache-names=averages,jwtBlacklist

# =========================================
# CORS Configuration
# =========================================
app.core.allowed-origins=http://localhost:3000

# =========================================
# SMTP Configuration (development defaults)
# =========================================
spring.mail.host=${SPRING_MAIL_HOST:localhost}
spring.mail.port=1025
spring.mail.username=selbdtest@gmail.com
spring.mail.password=Qatesst1
spring.mail.properties.mail.smtp.auth=false
spring.mail.properties.mail.smtp.starttls.enable=false

# =========================================
# Maintenance Thresholds (Baseline)
# =========================================
maintenance.speed-threshold=85.0
maintenance.aoa-threshold=5.0
maintenance.vibration-threshold=3.0
maintenance.vertical-force-threshold=500.0
maintenance.lateral-force-threshold=300.0
maintenance.lateral-vibration-threshold=2.0
maintenance.axle-load-threshold=1000.0

# =========================================
# Realtime Alert Thresholds
# =========================================
maintenance.realtime-speed-threshold=80.0
maintenance.realtime-vibration-left-threshold=5.0
maintenance.realtime-vibration-right-threshold=5.0
maintenance.realtime-vertical-force-right-threshold=550.0
maintenance.realtime-vertical-force-left-threshold=550.0
maintenance.realtime-lateral-force-right-threshold=350.0
maintenance.realtime-lateral-vibration-right-threshold=2.5

# =========================================
# Additional Properties
# =========================================
# Added default email for alerts (resolves placeholder error)
alert.default-email=alerts@example.com
# Disable Spring Cloud compatibility verifier since Spring Boot 3.4.4 is not compatible with the current release train.
spring.cloud.compatibility-verifier.enabled=false

# =========================================
# Sleuth and Zipkin Integration (distributed tracing)
# =========================================
spring.sleuth.sampler.probability=1.0
spring.zipkin.base-url=http://zipkin:9411
spring.zipkin.enabled=true

# =========================================
# Micrometer Prometheus Configuration (metrics)
# =========================================
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.prometheus.access=unrestricted
management.endpoint.health.show-details=when-authorized
management.endpoint.health.roles=ADMIN

# =========================================
# WebSocket Configuration
# =========================================
websocket.allowedOrigins=http://localhost:3000

# =========================================
# Jackson Configuration: ISO 8601 date/time
# =========================================
spring.jackson.serialization.WRITE_DATES_AS_TIMESTAMPS=true

# =========================================
# Banner Configuration
# =========================================
spring.main.banner-mode=console

# =========================================
# Vault Configuration - Disabled
# =========================================
spring.cloud.vault.enabled=false
